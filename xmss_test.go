// Copyright (c) 2017 Aidos Developer

// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:

// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

package xmss

import (
	"bytes"
	"encoding/hex"
	"testing"
)

func TestXMSS(t *testing.T) {
	skseed, err := hex.DecodeString("b041bf7ca73cc7905aadc1b6460da2e50206652e3d57a61487beb09664da308d")
	if err != nil {
		t.Fatal(err)
	}
	skprf, err := hex.DecodeString("303f46b2e4248b040a74e7f1eca3ff288b452ef4910739b466225ccadcdb3aae")
	if err != nil {
		t.Fatal(err)
	}
	pubseed, err := hex.DecodeString("115e28fb34d6414cd7cce714895df8c4a674ee1e557f1f3df99370aa8ab7c404")
	if err != nil {
		t.Fatal(err)
	}
	mer := newMerkle(10, skseed, skprf, pubseed)
	if hex.EncodeToString(mer.priv.root) != "a959a891573da8633b89e8f21e43eef9fca43a14bd2d71b1cf9ad5706945e752" {
		t.Error("root of xmss  is incorrect")
		t.Log(hex.EncodeToString(mer.priv.root))
	}

	msg, err := hex.DecodeString("6bd1b1ae8425fc98d33b804431f0085570ab4e5ead7bf1625eaa302efe9020325f0d2f5a9d49b37cb8e150b385cc4699081bf5c292398f5e11072689fb74b9951a9880f4192adc81e318d2516cca806a6a54d987ed1e482151937076a0985cb56bf86e8b91289c53df0faef9ece0f507387b0dad2a0689b0e40445eb7fe4ff65a9f559d082a4211908c4b271037abe3aae3e4f4bd0607598a795c3b10ebc6f5698ea3b73fdf696656c252267b28b9300ddbf5e985ca2814fafdf2ec19d4e8f4f1c78f6a3bc872e526fdd558104afa78e485383b89840cbcc2671fcad714ace703a0241b994d00c48723ec60f679736fe895c2a4155e15baa9570143430f56e4fc2e3a7757cd4e62a89347c7a72554b7f5421680e338e682659e4d85c8c8411cf01ee3536cfd18dd8f7084f3d3cf9498bb07043fb723b417b1fafb6b8014830a8764a6ff835f34b519c423b25d17dc5e5283f39acaada60d3b1f3e940bbfb9ba874447b40dca0bcee77b16f2b3b38ac70cd1bfe8419b7fdfbad6369a3a0a09b85010ae93557ccc0272445f0eab52acbee26eb8bbcb356a252d46626f934b58fb8bbf81d5d2a0e3bbdd378ddab70d4926a488f062e93322f316c6399d2773b536a91baa1a010f4c8df2b772ab63689a484fc8d22eb994f0b2588d995d6ad3c11f791b37d90f6bbbefe7df6d39b177ab36142ec5ae29b8817c0e1d37ab3f18a694f105b25516ea2f1a75bf8df17e930492eb6d849a3519f26cf1f3c50dd5614b5dd663c14acb45ccb25b29eb3247982a678f1fd79308897074af11a2ae54d5d964e5dcacd9e4476586b44365c633e2939297af999277983ac3edf1ce23c785587b24b30a3fa5223ccacc5f91f32b9540f967f92fcac9c88a84a055a873abd2273aa23dcd7a800e1225aa867218eb626839d8dd8c8b6e8b3ba81d98197ec66d28860d0bea9fb676966e444ff255955840746a84e517b340314a6c911024ecfd3501bcd2f86821d9a3db159dd200f16e10bafdf7bbd885c9383948fce204d5a7b34d3ff2973c8fac2504b76d1939daa930cd7c3ce3592bbc83f8c98f964aaea59493dfc00e95765724369e16357cb90ff2e9467350d4212a80e43272e481e57c16a5f907e8e0e4a577a793c5747c7068edfe23858c38523faaaeddd29af3236761771dde186e9f46cae665fedbd1b2406ddc3e108e6f0349ab952cadb65cffa3e2cd6e6a0d9488d66e3a2fcb2f02d47cf3fb86fd40f744e4f7f46984b47f096f865491580cab66cd884f9663165f5b55e3eeb9248bf30febc7e494ff6c3a931bdae60bf9f8c8622e2a04359adbf28444d3e444bcbb9699a3b3051481983436407af6396f744864fb3a5cd672fe667274964298cdc550e310040d83a57e2fd4aad3c66b10f29c0f2c015b34be2588c949026db6ede09e543ef397d3aa1ac4243387fc80ca79a797e3b4abd49b65e12ac91837c115b118c23420c846b525cf13aa300257d2503733ef1788b1cdaafdcb738433e807c47e273c717f4f3e631325ff95b800c9b081e9d737f640a85b925cb565f268ff85af83ad2d2d7395c7892908760d06ce8d37e07dedfd83ba11c45b50ce08470400170a2aaf2985c9336863fc663d2eec39a7594e0e40c054abefb7ec0051ba0c13460d1f3dc7797e80e02ee41adcc61aae7c709686cb38d47b3bd16973e2312d93c47c7612127ee04a931e0736f616a7faf80702cf472b5756c7bdd1bc3ca7f4d9fe3d848b281d7eeb50ae6fad44210205d9a0ed37925eead032e0099999416f73b6b9142ac5049a003b364c39cc51c2fb1bb6704a297aa3265869615ab9cc7b218fe9671aef3f5d1940ac339bc7f45063bb4b42084eff3e0dbda8efda6ca6c5ddfded33712500cfd3b80c5776f5c52e5a0875a2a5689c91478585e63e57319d6c5e4228a38e95c0cb4892822ad17139db6e1380803d49cd6b5f964c2e48471002244c66be1893235d5a8db1835cf45d0e74663ad4eb6f70f7917f06d9e7a43b0f11aeb45dcdb8ad7b9d40d73b1b81fb7956c02bfabd4632c7da726b20b1e43ed99814731d9009b3f66a4de89255a37bd29fe3bfd0333ac94533579fa34c5871b5958bae1d0e76404496991b4f10667f7d19df47f4d34d279a2e257440e45b46159533990cc0163834396fffdd249e9686fe12a05cb690bb324207731a182a3d869f7c287a4709f78050b25a9485f48b412f13064640e914162e3b679131994bc358f2844801c75e8654c2e63136a6b87605fec6af1320f19f36b775cc2193c9fd4c9d2fdcf6792f9ffa9b486d944cfcc1b19ca253d6cd9b245b66cc122efdf66734193715485a55456c785fb86bbebfe8ecaae126a96ba4c799c88b9aece91a9e64e25b67b14175f7a7cfdf6a08bd8fdd1da392a3fee794c856dff760d0bdbc3e364b80751cc4e9b789c8a8e3ebe5e59dd315cae30a43025a87d336211f05dda1db18f90f789025fdfc2af5cf70e230f7133bfae60036e028d628aae40e98f3247b3eff4d4603ca2422424676af215c765a7e883e818512736899a96351d3bdd0be8dae10f8d2db0e082f0b54340c3ca2e6b5e55341e2eda64c8629f787396bbba9d262477af2f4a3558f80d05c0070feb557d15556623b49be2d88ef0d665fca9306cac5ad4e575915502dedca1d5fe0c025c980e834a2ea3f8a61d371cac7b038b6a7234df6b17d494860dd55326db10dad79f00153895d672ffd4806fd5a5bdf53f57aedd75e27a0f8693d49bfb447fd549800a533eed550b8de4df9f419210cfc6e1c41a7b2ec0a698b5372640684e5c8a341e9de65395de82461550ddf6151cd9a46b9b8934c31d28b2a2670c64e91e864e7f20ee2a65b8d802fa38839ed863949dc127d65873cbaaa8bb4049b37d382c20988bc5485a8099385385db4b28a5d7066c6655b9725f7d395454f248957f86d0807ef09fad016db752c17714886f27a6ea392990d01bb782f88015bdd9515193d7afa641e6157893d6ab165c64e4dafb7c9ad4a0ddf2dd77f73d85ba9f55b26464a2e8b42050c4198dc282297a5d2bf46cd37c0d4916861cb9ce2ea7379d786e570494597918bc730f0fed9ae6eb4f374fae002f682085196454993945a74c58f3eb92ad853ea41cb06808bf6919df58cee3478e4924e3fa753261a0c421d1512f18d52691622b354ce6ca846c80ecd433df7708eccb71176915d6c590682403f01bd8cbfae1740c829bea7ce053718c0b204f73a976ab107fbd4779ed8c4ea1faa868fb695ca05e922df5b9a29bb81e5c12758d4a14985f1c9403efec23651a047bac20bb755c0fa3ec2446601c1e8711be0e681c7bfd0df654b4fabcb47bb9787a7b17416bdce001ae1694a00af222c9dfdc33fc9ac0aab9d9ef3d5b7bf4ba8a494f937d9c873a2e748fd087d7f383c7b873814a20fbaf7a37b2c37e308af6c1c1588a4523a0671594a99ccca5a6dc2aa321e0b58ba390f899206621a7781285cbe2d9aea7ed7756219f607348c415b00d34a75ab22053ad1756beb69af1216d05f1f132baf666613f4fa149f7f51611c6addeff350add6555e1dc9a049b2a5166baa5599daffc8a9274d4125578589f4d9182e6b4bcc37f6bb3bc707d8451d330c812d4f42acc2fd63a80b77f2acd86469be7fbaa34674f978be1d6a5dddfd1df49d97968003b13bf3a9d322bc5b01457ee08126ccde914de442300bcabfbfff5fec22aa9fad6d3357d363381222f30aef45d3515f3b60a6ab3d664b634507ec8c3865a47eced90203ce9a39b2a3671c8033b201840da18436c7d3c89b6c602e29a05c0f55e2ef4bca2746f1af04c0707cdf7f2e35aa33ac8a00f46d3672ce8ddba4af904117af2fc40f989ee591e6baa412dbec666c466f75ab9f5a61424444061f3bf53de83943b8e7cbfccec79352eb35512a6fa6622f978715c49fb11f9cedc931918ab51185c98a4c66d2d37da16a11b28a8fec727710d7f70dea5be4ef84609319c01ab1d88148ed8fb79c4886e18279b2b77dee20dd7a5d4b3d9aefe04f36aff01196601fd5664372ef0e8796e7ddf4a8f0952c3dd30d2280aba2b766e5a3d2b846c1891900f6f46ca023e2f0cc08e10cf69de2bc5d48edf427741f21914f905955726a8d9c6811299ed568e96ea5fd35ded053ddfbca4b2a801d1cf651fe865bba7045abe8c5ab0e2aa4808629c291842390d8dc94dea845c477aa2a1dd0a3fa442a6d2262f0f607ba52b8a63a26814e0193d89c5d0a02d667bd2b0d1733bf1cf189b6d179b30970dbb59db5523f3cf672f1ed49e7f1f2a38440e98064950cca61bfe6fe3a24e1c1278828fc7b8accdccc926876dc875229ae06f320e07f0e3fadbd1ca967495be3e36a44767efa0e7a862a1bfbbf935812fd67093850e3d0fca0efa550c777195280e9a2497d4faf80999a9add95aed27487999a377b0f978c06a6c2ff13ebe88230b7adef386edd3d93e38ee297249777e8b23fa4cf3e462e918c4311b9dd51f7c5cb6364878fde4099708e7f4a3a5fe85209097ea77f6985d0415434266a2208029551c07b85a9433730c4515ed93a5f7545bc58e107206dedcd19a3ce7dfdd462bc786d4cfd4b2841c5d0d9f066261d648a7863fbe08803fb53b6e5b21f89b4150d14bab64ca23dfbb97070e20480c28aa1e2a20962db6a3350072edcc452c165d1bdf36e21267ca7a457426fde5530f903cf0bb02a23748e759ccc4475d9871b31a4f2267081db2e8ae2f5c8c1ae2d06642611b63c722cafab07255df4aabad93ad840cd5f1e2bf52bb387853a19f12c21fae20e24e01b73c3051da25767f08eb9543b840a81e3041cf6d356d7491545c0b3d90c9aeba3a71b0c2de6d6a333f782c122dc89ea2609be7da082224e2b6c7deb671a18c84c2716e19138658739f32a577e9a73e58a7e8f9544190635b")
	if err != nil {
		t.Fatal(err)
	}

	sig := mer.Sign(msg)
	csig, err := hex.DecodeString("00000000" + "115e28fb34d6414cd7cce714895df8c4a674ee1e557f1f3df99370aa8ab7c404" +
		"2e988488989c3c60d881dcf702f69dd321af41865b7acdad535251f0681b1d1a24c3159f7c17e80639a6bd13a8197cf14591409cb9df1be4148f324a4db132e5d1fd634a15c2cb42e2dff30da0f05f9b21df8a162d8f01b081683a4220705da2c06713bc7a4a05b5d21c586bd1e4bfa453f73d58e4e2af41e07b799cfa7c7009a1c83ef26d1dcad14ec3e069278da0d2dce62838bb5b420b810e376a5825ba4ec7bff63ac3f7895c937fccaf42fb54e071e431353eca289bfa4d00be5fa457b1347f3166e86ffe5c39b1a8776826e3018272fad8b64c1a7ccf14ffad48abe932b1cf440f8a27e9fba5318243d3ad4cc30c9f885f0cb6671364348ce9b730a67bda011433e4b036537dbb50c7cb47fa52f86d041cbe381542de51f6e25950806c91e036bf48c4920d2830c5edfa69b30433ee6cb177e3598af3c0e40e1e401684df30c800fe1803c7bb2b4537fc7ba23a6cf709c28b0387f3cd7a2e506b74c42ce1d341ea4040a80303373006d7a6613030ff4133d965ae1ae8a127c81b0702ccc1b65c282bae25f86f06657d4d7ec962b7a3d380a7b338c73b30c0f5794c2994492cdeab0a89f6c0365a64a2a15ae47b552e9c1c70cf55d1ee7062b92772e36ed15b4444d1b279a1533f4237b1cec4604bc47b3a88f8ef4decd845c9ebcdeae48a09ef0fb0675980cfcf3d8d32fe24fceab08948889052f1ea474797c9f82430dff0d663b7f901a6490d1bfeccfbe78ad23dd6aa4ab2ff1c6b06320a5a746a643aafd97824e748e08f1f5152473e5dc36cc147fb251cd9fb8e4de5ce54069a268ea1e214d61b63e78542bfdc6429d2bfd57612ae374d09972f28fd16f6f72ed17c44cafd18322ed925a36fb6149f082d87c4de52b78ca60cfdb5073fc85f3a392d11013394e45142749d085460091235d9f26ef9bc8ccc8b7e66207ceca74389873e42e136560620cf32d5c97b3c0d83461f9dfbd1a97a420e1b6b24be288e14697d064e4c6335db23fccec382a94ee47541901871ed64d4e5cec21f345b82f48badd501a57b07050a65fda65f4964a901561c882b86513adfb3c31059d59fbaf5e87e924516956b43c6801d43ade723c0517a594a35c952f33e6150d35f6cc491d49517e28567d1fec2318c11390669bc7d20700717584fb96887288f5817d1ebdcdbd53d36f2f15b4b19b456c8e6c6f7a318e147b5eb01464f9a6030889fc59bcc41febc33a19de44306d5555fc245aa6c776f48a4a5a95154f24448f485e63294eb1b257f758404008a74a8a1732a9c10218a19e492c989137462917e012332ca4bbde12abccfd24b424055d2bd54ccd990753c9f375890d60a5c05fd71597c720276e32aae1874d4dae4639c916f018e49fec6377105f570a72c2b6110cb79a006eaa8ba0853f85c12acb29cc5a1a51772f1e7ba37684d27044f223b7b18c260739a4629fb65e87baed00b3cde3cb783d29f0df8ec8d73de980b791a27b1013341df742a01f99ae13fcbb663f4a2fb46a7b69e11a94fc839c198f1b9a4ed0059c995e2dc83eca3333f11dddb4d3cff916ef9ca57569a255941c05d111af3c103e14f8d9c831f17d2d43b39a5f42b9d0bc96ca039b1e49d4c6f47e61b480188cea5664e61596de0d0a87be61a1317018275ea3e2077649cf85e5c6d6a3f0c253014c06f3fd654e6f50ce99b53671d12b0024901bd9286e3f767a345b0cb798b71ee1ad24710beb58663e5239ded5d54531b4fd1a36b885a6b8d9b9a83fced90d1be5639ddbc9893ad3e89f722d6ddc1d4cd0ba7b699854369d1d866205db5de882d4e5a1622c7c568412521bb1efb1bf615215842b03634050b1fde31688db05c84b05a4eed3c9681d86df3164a4d274d5fdf385a18bc7a1c368cbb3e5b7b6558bd66cb04fc8a77f3223aa0640de5fcfbacf60af105971c4c4d9d3566dccac843b28ec3ab22d630e245ee12943fe2f1452179817625b5926d232979760a421d9acce4a0d9bd6929faa388953efbe82eb4de3b8e5b96c0093ff4d63a42a61490fd3df24830f24af575e38acef3cf5bc6ea8e85819dcb6ea0b269ea85f763f3aa9e30d5fc621ec1888b19230771af141208b33d74227dd3a33df5279a6ca38f96019e9fc6f4075a9a83502caeabfe6290424dfe7f0f881724cf238aa83cbf5eac151cca12533d6ec5fc487316c3c290637007382e85f0ed06fb186ba85b5ec448e635dd12ee47e683208627045e4d2f7bd9115120460a64b546e7a1a2012129461f7c14160c0351951aa25a305a4f76824503d6f3a7c44dc8179f76d16e9573503666a242ebd56d10e5e723d715cd5da0136e7fca8c676b6b521ca49ca64cbb289424da18678c935bc7578b43a0bab52e3137ab800b5aaac4954e27e8498c105abe52c612d5672326d3aa2030c432c026f2202480c9bbe37aa8db7d7af81b09093194aec1ffa30d3e53b673c0cb96c98599effe661b743a840c03b0910b37d1751c30695e2b7e9c37df2fe334da8a224fa6108d1225edb9d4169e44dea5e30cb5f6f5a2657a26fa19f039a94e20e37f31f58a327d2e61348f7ff6a43e0eb128ee524d7ae37ca23c9ec95953be56481dfe734d652a00337ecdc9d9832c1b048fc8a6d6f0c026551dbb182a41022cc8218c6946454c35c37d8e4a49a8c565d01910767a1d1a27fcfbca1b4dd6348d2dc5b2a249b2c30042e2d6312b5c1be437e6962d9d36cd71dceffd7cdf87df9f49f3f4d6ef89992ce9f07e6c116b71a0a1036e72f9069f8e08bc2025ef5e45c485ccfa135acc1d4841bc57e4116ae43d9058ecc851a6af84ccc6764de587176dd159a42a032afd2b392f0ab97ef674fa2e2c4eb6f00685e80686584fd94dd76d48a40a619508cfd92fbb8fbf3aa395c588afd6eebf6444ae9b956c29ea6be1768811c8fa02c1dc0b5034c298e8dc8c1e0b00e554483d3112440af818745f163d529dc26dacc54db1ceda5562986687245d872add971077dbdb405f5dc2abe51de713e6c9f05c9ea8b093dd6188a114632ed021d704488751d4b22f66b59aabfcadd11c30339a13049cb156f4581073486bad0965aeeef7349c81cc449d481c52c20c122db190d04f4432146e7c64241b43284a4d06e6213d71075dcec463639eb7beb89dbecafc95e4d8c7e4689f4054e41978014e2577c509ba16705ed109cbeb2356bff4631672364d70b5b9c5dfe41b2a6ae6fba61e35ee83ee377185cf735e10e493ca2ce642d789993d2aa20f876bbb837f3b9b5e3df8da433fa5683749efd7f4d00217335945f62b03a62ae2071f893a8c2726c35b83f5f181aff67b0365b639f1375bab04803db5d7969033ff85bdc3103afc07c90a4d3fd36e5ea9b4ff43481f45ed60ca7fbf4aa6586e99e5bb00f30f9f1f096a8bff6710c101324cbbe33511fd3ae25f7262774122a22986e51a76619e71563be23d4f93dbb604c3c2a267d933d9fb91675fe6f7c46adac7e053f921e441256a1fd568a5ce8975030472f916f7fd60da82c7eb57636145baece46bd1b1ae8425fc98d33b804431f0085570ab4e5ead7bf1625eaa302efe9020325f0d2f5a9d49b37cb8e150b385cc4699081bf5c292398f5e11072689fb74b9951a9880f4192adc81e318d2516cca806a6a54d987ed1e482151937076a0985cb56bf86e8b91289c53df0faef9ece0f507387b0dad2a0689b0e40445eb7fe4ff65a9f559d082a4211908c4b271037abe3aae3e4f4bd0607598a795c3b10ebc6f5698ea3b73fdf696656c252267b28b9300ddbf5e985ca2814fafdf2ec19d4e8f4f1c78f6a3bc872e526fdd558104afa78e485383b89840cbcc2671fcad714ace703a0241b994d00c48723ec60f679736fe895c2a4155e15baa9570143430f56e4fc2e3a7757cd4e62a89347c7a72554b7f5421680e338e682659e4d85c8c8411cf01ee3536cfd18dd8f7084f3d3cf9498bb07043fb723b417b1fafb6b8014830a8764a6ff835f34b519c423b25d17dc5e5283f39acaada60d3b1f3e940bbfb9ba874447b40dca0bcee77b16f2b3b38ac70cd1bfe8419b7fdfbad6369a3a0a09b85010ae93557ccc0272445f0eab52acbee26eb8bbcb356a252d46626f934b58fb8bbf81d5d2a0e3bbdd378ddab70d4926a488f062e93322f316c6399d2773b536a91baa1a010f4c8df2b772ab63689a484fc8d22eb994f0b2588d995d6ad3c11f791b37d90f6bbbefe7df6d39b177ab36142ec5ae29b8817c0e1d37ab3f18a694f105b25516ea2f1a75bf8df17e930492eb6d849a3519f26cf1f3c50dd5614b5dd663c14acb45ccb25b29eb3247982a678f1fd79308897074af11a2ae54d5d964e5dcacd9e4476586b44365c633e2939297af999277983ac3edf1ce23c785587b24b30a3fa5223ccacc5f91f32b9540f967f92fcac9c88a84a055a873abd2273aa23dcd7a800e1225aa867218eb626839d8dd8c8b6e8b3ba81d98197ec66d28860d0bea9fb676966e444ff255955840746a84e517b340314a6c911024ecfd3501bcd2f86821d9a3db159dd200f16e10bafdf7bbd885c9383948fce204d5a7b34d3ff2973c8fac2504b76d1939daa930cd7c3ce3592bbc83f8c98f964aaea59493dfc00e95765724369e16357cb90ff2e9467350d4212a80e43272e481e57c16a5f907e8e0e4a577a793c5747c7068edfe23858c38523faaaeddd29af3236761771dde186e9f46cae665fedbd1b2406ddc3e108e6f0349ab952cadb65cffa3e2cd6e6a0d9488d66e3a2fcb2f02d47cf3fb86fd40f744e4f7f46984b47f096f865491580cab66cd884f9663165f5b55e3eeb9248bf30febc7e494ff6c3a931bdae60bf9f8c8622e2a04359adbf28444d3e444bcbb9699a3b3051481983436407af6396f744864fb3a5cd672fe667274964298cdc550e310040d83a57e2fd4aad3c66b10f29c0f2c015b34be2588c949026db6ede09e543ef397d3aa1ac4243387fc80ca79a797e3b4abd49b65e12ac91837c115b118c23420c846b525cf13aa300257d2503733ef1788b1cdaafdcb738433e807c47e273c717f4f3e631325ff95b800c9b081e9d737f640a85b925cb565f268ff85af83ad2d2d7395c7892908760d06ce8d37e07dedfd83ba11c45b50ce08470400170a2aaf2985c9336863fc663d2eec39a7594e0e40c054abefb7ec0051ba0c13460d1f3dc7797e80e02ee41adcc61aae7c709686cb38d47b3bd16973e2312d93c47c7612127ee04a931e0736f616a7faf80702cf472b5756c7bdd1bc3ca7f4d9fe3d848b281d7eeb50ae6fad44210205d9a0ed37925eead032e0099999416f73b6b9142ac5049a003b364c39cc51c2fb1bb6704a297aa3265869615ab9cc7b218fe9671aef3f5d1940ac339bc7f45063bb4b42084eff3e0dbda8efda6ca6c5ddfded33712500cfd3b80c5776f5c52e5a0875a2a5689c91478585e63e57319d6c5e4228a38e95c0cb4892822ad17139db6e1380803d49cd6b5f964c2e48471002244c66be1893235d5a8db1835cf45d0e74663ad4eb6f70f7917f06d9e7a43b0f11aeb45dcdb8ad7b9d40d73b1b81fb7956c02bfabd4632c7da726b20b1e43ed99814731d9009b3f66a4de89255a37bd29fe3bfd0333ac94533579fa34c5871b5958bae1d0e76404496991b4f10667f7d19df47f4d34d279a2e257440e45b46159533990cc0163834396fffdd249e9686fe12a05cb690bb324207731a182a3d869f7c287a4709f78050b25a9485f48b412f13064640e914162e3b679131994bc358f2844801c75e8654c2e63136a6b87605fec6af1320f19f36b775cc2193c9fd4c9d2fdcf6792f9ffa9b486d944cfcc1b19ca253d6cd9b245b66cc122efdf66734193715485a55456c785fb86bbebfe8ecaae126a96ba4c799c88b9aece91a9e64e25b67b14175f7a7cfdf6a08bd8fdd1da392a3fee794c856dff760d0bdbc3e364b80751cc4e9b789c8a8e3ebe5e59dd315cae30a43025a87d336211f05dda1db18f90f789025fdfc2af5cf70e230f7133bfae60036e028d628aae40e98f3247b3eff4d4603ca2422424676af215c765a7e883e818512736899a96351d3bdd0be8dae10f8d2db0e082f0b54340c3ca2e6b5e55341e2eda64c8629f787396bbba9d262477af2f4a3558f80d05c0070feb557d15556623b49be2d88ef0d665fca9306cac5ad4e575915502dedca1d5fe0c025c980e834a2ea3f8a61d371cac7b038b6a7234df6b17d494860dd55326db10dad79f00153895d672ffd4806fd5a5bdf53f57aedd75e27a0f8693d49bfb447fd549800a533eed550b8de4df9f419210cfc6e1c41a7b2ec0a698b5372640684e5c8a341e9de65395de82461550ddf6151cd9a46b9b8934c31d28b2a2670c64e91e864e7f20ee2a65b8d802fa38839ed863949dc127d65873cbaaa8bb4049b37d382c20988bc5485a8099385385db4b28a5d7066c6655b9725f7d395454f248957f86d0807ef09fad016db752c17714886f27a6ea392990d01bb782f88015bdd9515193d7afa641e6157893d6ab165c64e4dafb7c9ad4a0ddf2dd77f73d85ba9f55b26464a2e8b42050c4198dc282297a5d2bf46cd37c0d4916861cb9ce2ea7379d786e570494597918bc730f0fed9ae6eb4f374fae002f682085196454993945a74c58f3eb92ad853ea41cb06808bf6919df58cee3478e4924e3fa753261a0c421d1512f18d52691622b354ce6ca846c80ecd433df7708eccb71176915d6c590682403f01bd8cbfae1740c829bea7ce053718c0b204f73a976ab107fbd4779ed8c4ea1faa868fb695ca05e922df5b9a29bb81e5c12758d4a14985f1c9403efec23651a047bac20bb755c0fa3ec2446601c1e8711be0e681c7bfd0df654b4fabcb47bb9787a7b17416bdce001ae1694a00af222c9dfdc33fc9ac0aab9d9ef3d5b7bf4ba8a494f937d9c873a2e748fd087d7f383c7b873814a20fbaf7a37b2c37e308af6c1c1588a4523a0671594a99ccca5a6dc2aa321e0b58ba390f899206621a7781285cbe2d9aea7ed7756219f607348c415b00d34a75ab22053ad1756beb69af1216d05f1f132baf666613f4fa149f7f51611c6addeff350add6555e1dc9a049b2a5166baa5599daffc8a9274d4125578589f4d9182e6b4bcc37f6bb3bc707d8451d330c812d4f42acc2fd63a80b77f2acd86469be7fbaa34674f978be1d6a5dddfd1df49d97968003b13bf3a9d322bc5b01457ee08126ccde914de442300bcabfbfff5fec22aa9fad6d3357d363381222f30aef45d3515f3b60a6ab3d664b634507ec8c3865a47eced90203ce9a39b2a3671c8033b201840da18436c7d3c89b6c602e29a05c0f55e2ef4bca2746f1af04c0707cdf7f2e35aa33ac8a00f46d3672ce8ddba4af904117af2fc40f989ee591e6baa412dbec666c466f75ab9f5a61424444061f3bf53de83943b8e7cbfccec79352eb35512a6fa6622f978715c49fb11f9cedc931918ab51185c98a4c66d2d37da16a11b28a8fec727710d7f70dea5be4ef84609319c01ab1d88148ed8fb79c4886e18279b2b77dee20dd7a5d4b3d9aefe04f36aff01196601fd5664372ef0e8796e7ddf4a8f0952c3dd30d2280aba2b766e5a3d2b846c1891900f6f46ca023e2f0cc08e10cf69de2bc5d48edf427741f21914f905955726a8d9c6811299ed568e96ea5fd35ded053ddfbca4b2a801d1cf651fe865bba7045abe8c5ab0e2aa4808629c291842390d8dc94dea845c477aa2a1dd0a3fa442a6d2262f0f607ba52b8a63a26814e0193d89c5d0a02d667bd2b0d1733bf1cf189b6d179b30970dbb59db5523f3cf672f1ed49e7f1f2a38440e98064950cca61bfe6fe3a24e1c1278828fc7b8accdccc926876dc875229ae06f320e07f0e3fadbd1ca967495be3e36a44767efa0e7a862a1bfbbf935812fd67093850e3d0fca0efa550c777195280e9a2497d4faf80999a9add95aed27487999a377b0f978c06a6c2ff13ebe88230b7adef386edd3d93e38ee297249777e8b23fa4cf3e462e918c4311b9dd51f7c5cb6364878fde4099708e7f4a3a5fe85209097ea77f6985d0415434266a2208029551c07b85a9433730c4515ed93a5f7545bc58e107206dedcd19a3ce7dfdd462bc786d4cfd4b2841c5d0d9f066261d648a7863fbe08803fb53b6e5b21f89b4150d14bab64ca23dfbb97070e20480c28aa1e2a20962db6a3350072edcc452c165d1bdf36e21267ca7a457426fde5530f903cf0bb02a23748e759ccc4475d9871b31a4f2267081db2e8ae2f5c8c1ae2d06642611b63c722cafab07255df4aabad93ad840cd5f1e2bf52bb387853a19f12c21fae20e24e01b73c3051da25767f08eb9543b840a81e3041cf6d356d7491545c0b3d90c9aeba3a71b0c2de6d6a333f782c122dc89ea2609be7da082224e2b6c7deb671a18c84c2716e19138658739f32a577e9a73e58a7e8f9544190635b")
	if err != nil {
		t.Fatal(err)
	}
	csig = csig[:len(csig)-len(msg)]
	if !bytes.Equal(sig, csig) {
		t.Error("XMSS sig is incorrect")
		csigstr := bytes2sig(csig)
		sigstr := bytes2sig(sig)
		if csigstr.idx != sigstr.idx {
			t.Error("sig idx is incorrect")
		}
		if !bytes.Equal(csigstr.r, sigstr.r) {
			t.Error("sig ris incorrect")
		}
		if !bytes.Equal(csigstr.seed, sigstr.seed) {
			t.Error("sig seed incorrect")
		}
		for i := range csigstr.sig {
			if !bytes.Equal(csigstr.sig[i], sigstr.sig[i]) {
				t.Error("sig seed incorrect")
			}
		}
		for i := range csigstr.auth {
			if !bytes.Equal(csigstr.auth[i], sigstr.auth[i]) {
				t.Error("sig auth incorrect", i)
				t.Log(hex.EncodeToString(csigstr.auth[i]))
				t.Log(hex.EncodeToString(sigstr.auth[i]))
			}
		}
	}
	if !Verify(sig, msg, mer.priv.root) {
		t.Error("XMSS verification is incorrect")
	}

	msg2, err := hex.DecodeString("1cf6a9842f3108c2f5f18064f0879997531b4dcf2d7747dd5f94ceba2e3f6882ed42be6cea55f854d0a86712f7073a5be0cfe23d9ae0a7e0a3ad60eddae32ca239a176c1a7c078673e957020b3a0cd1b8ed3271bc280e0efa5bb1f58ff52e8e64479a0a684748f61794b58851bc8254fdb34e7513409eefb401875a4b7cb043c09606f06f5d6b86ed258a9def562d0a526ca14e80601fb8f87436b67ba681d0103ef87d0774e7687e569c20ddde5910c87e5aee1e56d5ef18016383c097d60ca75a7766b6341732b10f4fc91faec2707724f5c45f4234be8cf5a2ed2ba808336a1cff852fa8fc9bf732b798edb667e0f8bbc8ca282be8ecd3b3010668f3b87762f7a0453d7cc52a5fb99a7b50d8463d557cf28cfec00a31e81f57cea787ea01800afbbeddba8b3dc902001f4c718678d22d48a97508e659048e002bb64d891001559ace7b3da3f1268034f8d274a4a5e9e202c5b025471b1eca4614f55a19c16f218f6066ebbd2b324e95eb061693f3ea62135786e4ab16f387c1d52c11e73af401156635ff04f985a42236e301bfc1f53468d3def5d72b030eb84c3ad3a8f18e1017ae06fb8d6747dc2d157a4fa662e3e2078cda593b99917a7b50dcf37e85a457d3b87fce200cb3522d7be11029f37ff4f150d62bf6398e4a143b443c2f03b6f5d33181e4184628ff33b183b14293cdef36680ba2e9125b4bf5e5e26e4aaa65a2d903a8957957e822f93f7189c0df89958c22c3578c55838db9079cc984c7bbe0da65dfdbe06b58fc006f850e8ec6ce929509edb66fb7023de7a82b08ce8816c422d872b8b7812eb7ebac4ccf1d68e09e3bc5eff4d8a7e691dea909e01eed97a6bef6e876aa7ff80543efb3d4f96d535840da1dbd765241b00b5d08cb5e4b5b4b7b4f942e4e3b84e0bd1fa94dc892deea546906aead8b4ca6ee6164474e427566ff96889939c6620460464c59c7576a05fa3de62b914335b837d3bf3e6faa6e7efef007402cdcd951d7e5d49a85abcb43625a659a94556e33f274b9e83f5a28476467feca29908e655a9b9fec748787a17c637b2394150a6c5b189ab5ef52dd282b5d6fe81fe0075edab6dfa40e60d46cc306b1da628e385302f93bb97f4f752acbd37630b85789a3e33c817b1f080db457219f51dca8e75ca7e37d73007a4da0589113340eb36988f68172e72cad01f53ec7fe6d5512aba0a47d963e319dd28235ae37b5fc057fae49312dd3c5ff95aa45a55f00527b9a918a2333ce249f9493596ff9e59931f38be8aa07b09c30df5a81d7367cd53a281af04f2e718872e0a6575c7349a9ece0e71c9cdbe163ab230f7bebd5ba80084eb0b476b491348172480363a144d46f4bc6f23ab18ffd013f514a51f1d8091350d37bd61cd17cb9989bc4fa5010e80eaac98119506fc9bd40cff3ccca43d394d1254b0475e5f2c075ba5ec7547e25940d84555e6d342015a74c7f2eb329aeb434388e1835fca54f44ca1bb5a9f52ba5dc1096224d75b5b096b0fb8f8f131fd431fd48e096fb59a385e371391cf86f511debd787baf3cd36536fa4e4e954ba5937f20797931621c5531c83400cb98c39691b7f2e8e5388200868ad6477b575e6c55555471e99886c52de05e470a16a62bda4ebfc015a3ff94235be8094146608c3a60c0e58024068992e209158beb5def1a018cc25988811a1273098624a119468ceeb7aa41b72d1ee710197e80d831bbf9b7b7aaa29c9b5b41285b3d7ea0a38878bf1f58bdbd4ab66734027e9114370729ca6d563bddb1b730a36adef665bcd47eac1859f1d3c671fd5c2e444beb60e2ff4b3f1a2e7f576d33f719b64b09f27d346a42d5f5ee908b2654c7ea6383bd67403dc3dfb76fbb4d92d34db92c2fee1bb02e08292444183974be649252c511239f20922ae0d9d8cfe033e304dfebde299a2fb2b16e0cec0f8e83f59ce3e5d01df66eb43d6c49cf19f6b6e13d471637101c93486818bc3054ad1fd8e53a7863d8ce34414b0d2a2ef82193c914d12afc3939e0b9a1583546db0c62125e567c11f799166835388b0305337d8c2ae3039be7009657b83acaf0dd943eb47d5730827126eb11852f0dad501e13f7fa4174695076157470252fab07a7fc5f679c75724af89b0eb5fba9a88bd825e126b98d3625e2f167516d1e2b9682088842cf3d7e91cc5c00ba382549f98c4da67dd42ddc3701358b9b48544d1c1abdbae46cf86bbffd85ef415cf51f343c9b85e7542dcb271f466dd864c5ce560dfd8d5c7c66bcfeb20712c8039518a4896edd70157509428619a558474477157bd1a477261bc6545d924b3c40307e113513069a1a2f66d1c8dbe8b56a9ffadc773a6181ad16bdcd0cde1954c86f672d5be0f00d8a22ccd4ae6a73d134012173ae1b75e72c95afc5d9649c058e8252a62f8df0f7c65d5614dbeb381d753ce377f21a2391071a78801c4ea3fce7ecc8287816aaf0ff3062d28ebf614fa27ad3f9c72e0f9367f8a83a4b83965fa2fd03aab55167c32e0001e3dba8aa78a80004968057c79a8162b2fc1fa39181336129d0e8b4e028c247ec8982c0fefec0930506713a64f504d58daf9fa2430d3560fd2cdca7f06e4ad0b1996a5767ec15ea001ae9239e6cf8b5f0f2086fe5520657c0a3a39e3942d5031cd14fb5a11e4b649c1a595df675fb30fd99cd3ea341f1d3d1b51853a6b552de1c54ad2b83cc1cc9d06503ac66655a1eea0fceadb41c87f9d03a90421ad27e2ff17bf7165dc29d38e933205de00d8e752138e5d3a42aef8702ba05f275417b56f0fe7c6fcdb9013063b556c09c768a2e28d6fbb7b61d37f7a9fa821fcbcdda4dd78b80686cfb584a1bd5ce5410112a8e63e7cbf1a062fcaac6a30707b153ce8c49a87987ce9c357138504078270b6c05bd9afc5d77717ce95a45031a6301e7ca966380bbb65cd7f9dcfc3260e512f49228c01e1e22abaa98dd6b070d85593edc77d877c2583bdc02c74d9d16183700a8dc552d86ba08bf28b3a4648b564aa202cdefa60e428b2ac1e8418220822064bbba3e551657bab08b6d19a8d25e07c0b0c05370315059f9b22ba20d32f3d80793eb086f98de2ced3d74a26f897470e34059e0d779fcfaa916d9e638372e5876c56ca9f6af509c1ff6b9d015ed5126040b178c99b8cd028e37a34a9eeaeae14e829a84aadcda06d3bb004ae7e05c75d3651c687901661c74cb9314c89e6cc137dbb4633a0cd19d429e239b883fd4bbe3a99a0a696d3c1c2075532a44a90acdc03277d679cf500b9079ce47ff8e996842fd826de65e641260593dac6e7e226bda478a893b4c0dc403e748795240c2a439849eb0581096508d102963e55179b48efb9deba7487926a8515e3f394553acdf0f913b28e997991df55bb2206d285c2bd22eecacb3ebd13c65116d4e1faba924330ef5c044ad24bfb183bf14c115e5a32586129bd1543a11219cb890cf73a255273c759dd527a12e2f0381703f9bbdcc6a214fc61249d5397f784a3229e6628bc0a354421968755baecb36b1dc66e1167ca39d25a044858c5c0c9ea8330fa76bedaf7f1db1c9ef7571a87f656e4d74e08f5409cbb39f10716e5b5868541819cc1ba19699a3752bf11090b86cfa9681edf7ed7d56df36aecd4d821d328a8aae906248644a8f183d92da8d32bc139039a859690f44e453293c6a56cda54b26f3bea80a148c67f1ac8f9070495d1fa65a8a9dc563500bc231a86e1e0da573b7588598a48085bdb606118eed18160843a114e13fe0617c7d697f2a712628f00f52a23015e3231f0e9752384b524c13b1d71126094d8179f8883de58655f0a01501ba36dd158ab7d43b75d9e86e8c42f1ee4f19be08e2fe624be9579456b1596d6656327bb798206845fc3ce5631c66fd178d3cd23b81067cdac0998f339ddc67eea1b1373ed846d12d3abf2070001b6fd8e2792c591443e7e6d6afa6fc48a70210bdb218cf11212690fae39610899d76a2924718e9855eefa6f75268f24ce01364e3167eedf866ca48afd150df24743358cf0d70d54007dc05634e5ddc94f381039665d3da999ec69fb40ff8b72552d081cb97933741da0a79cb1302aff1d94a4cbd8e7ee6b668577ba531dfc06da620ab36334cc92025183cec5a022e5e40179fa08c0b1160c61af80e27e25b30e0f27cec83c1361d646930e65e57fc71c9c4f00c8ab028785bfd1d183ad81cd3ee3dcdfb9cc569c756b6da3d71b9ba521f0ce984ec4d710c34c881dc9fd61f1b5c0d7c07da76973e74b793596ccfe4a615b30db1c4e814a64231456b4ec47278ba2506da6551b385d1015db6854ed2591328f8a90e36e7c339ba9cc9316e085e208a9f2666f35bc68dc3282e7ff223983b92dcf1c00a9eb2f68733b1388ebe3f496501354cde41bf04294d150de14945973564839e4b2a25022f911b8795a2f69cc9bc8ae99e844b890535bd654d03e119659c7b8ffeb171a7f4e0f501f2e1efdafca77cf43057df01deec7c16c9373c2c7534a35445753ffbd0b85cfd7cbd565b95c12454b7f0103c169a0a79c0f292aeb5f153dab9cba13664b514921732d99d361c5462efe85ea9e6df9576178155a9a10a6dac05b4ea2a56b42b5b1227fa507f2a14a427c617e8269270ff59706be36397ce5e5e1dd757d4fbc8f88447c4d3f42270569537042cc5efac628134bd115487ab3cc70e996f947abbc7885355bd034af03ddfe0d204293465fc8efed438e01893bbea9f75b6033b471c15f656c5403b94547c94711dd516ba04fee297b70ca8c5f76301808d53a756ca1782e9ec76abf9faa53753db8114956f28240ed3e744c69d11a3d98e6a4cfbd0bcac43f5856930296e5c5ad8ab36c6baaad365c1eb8c99b17bf9cef319f3d59671b0e8522d9ae8224f5bfbee8a9c59cf4f525f961c86c33cbff162ec84d0567835ef42385e")
	if err != nil {
		t.Fatal(err)
	}
	sig2 := mer.Sign(msg2)
	csig2, err := hex.DecodeString("00000001" + "115e28fb34d6414cd7cce714895df8c4a674ee1e557f1f3df99370aa8ab7c404" +
		"44E714665584FDF0AB64A9F80767EEB54E598BF791C023899086F1737F7DC27522788EBB3DEBD2D7F9FE8BD05633663DFA189C5C8F5F65BD88B4D7C1FB694F78CE45821AC50B273B27B2F58FFD974ACE4C64991552D3F014CFB3A88BB027230B8B8739DAEDC5F6522616D7D4DBAD879E230FBA9CC3376161A5F62C0375EBD72CBF57268D01B81D4023226175455F0EDAC218426E89BD93D92D70E07061708372A54C0C8AD06A428B5B64F89735043F344EDBAC769F068762B50BFB6838312E3C85F718BFDB6550049188F9E21D71221E58B06AA54544DA497C7AD80B0E4D596F64BDA79EE804587F8977D2F97653379DC67DBFBC95871BFE881373ADFA6BB2FCC840E0CFCC036F55D13CAE45E9A948386305D0B349EDE3BC8B2454AD0B7A2DEBADC0977FB62AF5BFA9E4D97172AF89C4AE02B8D4D08EA227E289838125DA8C0DF4E16DF8EF12251637E3083965E02E37BD53A7E77CCE380E615A2A9E98FC5222C832E987C238D313681108110EA9C74AD727558CDD91235B6B98E78CC6F171A1AE6B4528D2BE67A53265BB8D544463F868D6FEA0C932497FFBF197DB189D961929296A7769E98AA82F015BFB9A85A6B2677C77F39A088D3DA1A3098CB7A5CA57A088583150C51D019475152B60A224EB84F4EE002E9941DECFA7E5660D69774FEC5CA1D2AFB6BF209FEE7B24F37D4C376524EF82C227C5C8F04B6820B0FED8450EB1DD531A7D57AC600DCF1D611882AF6CDB37BF3E1D84E252C22FE24AF3E3DC1637B4338C02443AF7347DFA288F17D7706100582C6E13D0B1F05AC6272AABA6F884C17C4E508FB47F0A3FD462214CE0EED746A007A3CF317BBB13389E9860E5FAAFEDE19B8B71CE78D00F394A618E841EFB37DB4B95B2AB34B73AD8401E14B9AA9A3F685650A698C61E12986D5DCE4893A29545BBEADFC543E1CE685994AA0C94FF7A04CAC3BDAE4C75773000280BE5A7620975781208537E781DE8ADACE79139247692DF9B849C719268E661EDB39ACD4AC399806C54EDCCFF612C1EBD57109B3B6BF073FFE7E56C148127A07A985E5AA92F1A2145916B92F89BA341F05EEF545EA20BEE274420FE1044E1B2BE178B8F8D3FDBA4E47167251D1E9128C9B54DC3B698257C38E488FB3F50B14F438658D4BCE73350FE534A7FC9958336BC2A2AA0FB84FFEFFC2E02DA72A97D1C6C0022602D01C1162C2E8221AB46FE3215ABF08D8CD506BDAA10B8AB579B6011C8201AA7ECE4246DD4954E09E843EA9B3B362BBD67D620636AC5265A8691D62CECBE022582955C8327F0D7DD42AC83BE0B2BE164060B640D653B663693E395BCD41D55C7A71A2797C2A166CBA9D6117BF40B88A497150B95F839789E35DA318EA7FC97E82A53B3BC53B1A8BC0570CA26509F955FD51C0228B4BB5AEA19D6E0BC7DF94D39FA9DC0DA50E32E73A6D95053561D58B47DA2190DCD4676FCE0E6613E59F1682EF9511C715F22D2C2E7BA29B6B614B0CC05A521BF0AD4F8C0DC0B62904D8B8F88374CD2D7A146D57110CBDED40EFBDF192A78B4B767D3A474D97F4C73B0BABAAE2F4F780F24C83A95447EB9493AE3578F675222BBD3B547E53DCCE1AA6FA5A3EF2A11F6C16DF53D5F7E8FDA216150B9E11E468536B1A3B2307312B969B7A9C446C62C8015870527F16CFFBCF5ED30CA0474AD0E82DACC8FBD3133C052B8253C85D271D438E59D00415350BAFAF406A20DD8658718DBFE3F9EAB2CB3DF0FF122689E63C7FB5E8D11ACCA10CB3CCABFD7699C003B5AEF7CC083A6EB3CF4E70CD5AFA1B9C430E2F89459B9839AD063E9C19CC3EFBB3FA4AF88C50080E48F3F9E61CB815FE0DC08D2B162C8C87A2F66ADB19267BF4D92AA3774BD0E7206CDDB1FAFFCBF346AAF9CA51B8183E7B051B30A5A71434649521866E903ACCB7C01F2CA5813D5EB79B896322D8CA252EDE317F3F7731A5931C829AC404492D1FA44436087181D325F4655B5D1B0ABEC2198AEC80BC448D9FC571BEF83A47615A85D5B9D70FFD536B91B0C794793E64B4F678F7BCA706ECE1240760799B0DDE1E994E40AE4AC4B6C1C8D3F741124258DE879838C4C08FD0DFEDD59E036D52885868B2EA5335E24A3AB3DCDE14539ABD739991C1D1D88B15CD67D98A93F65865390EA0001423DB2F2E2BDE8DF698EF8E8DAA5BAB674A6A551CAD9E5B110408D1191A0157741A3FB4A6BA36A717E3C58785246C8AF1B28C14AFCE042EFB9BAC4AB3E7D7238A44A7CE30A1C73F647E53FD4FCFC39D94630D7400E2A66E2526D31D9970EB2036DFDD791AAE41F0836D7FF20B4AFBD9AAA0379530386523BC4612E87927B356D0337703890B41F16DB5A1120C8ABDA6C9ED27E1628322E059C80AEA8FECF41F48DBBA19B27EA113082C09566885568568F5C2E12E1149B2A4EFC3CEECC02AF7F1F2050C406F4ECC53881186AB01F36DF7F386207E9428952F0D1943F38567AC127C6B26296F0C74DDB88A147FFC8DD20C4C4E76D0FD39A4488EE442833CD56A0DFC666BF74261457B0042CC7E0688168D1768DD38C98E6B601E58C970E7CF7B3A19AFCAE7392CD3A4216038F4666310407664EBD869C671D3432C760547BD58920B34F7FDCD881810F566058D1B4ACAFF28650D805DC3E24EAB4572E4E8771090C6945167F63AD60DFE8FD4306E961F0BF0728EE6CF1B919E484440A5ADDE9250833137AFF682C946141797E6C9D1ACF83216F5B3B7AD04B9A0C59BEDCD0A97D3962417F29697783EEACC4979525F854F89E24551796ACD45F56A584A9EA6652A14DBD20117C40AC0A41A0D3919AA31202ABF63AE3A6A40E868DFAE361778B9E3EA9844C020C22742BD503A6EC01546CA1B918424C0938F25A79E3A14864707CB3EC70ECCB104B247EE0668FD0D119EE93CDA0AEB46D930BADF3FDBFC4982ECD01FF45689B030AE92FC18E5C788034E3C4F273EEEF07E654651C510F0AD8C8E29D9E9F8553E1A6C26891DA4BDB2F2A7220C966BFDEAF4A91DD7341F8DFBBEB1F07D2089E35A6E528854931BE08E776B87B9C3EF04D357B524349CCB3C5EDD92CE3771D6A8BF5DA23DA19579DB80CE6893460E3B43AB0DFCA605B1BAF147CC5C2B7DCF017FF8CA8AD7EBD1FA20FB079EAA34A4D06E6213D71075DCEC463639EB7BEB89DBECAFC95E4D8C7E4689F4054E41978014E2577C509BA16705ED109CBEB2356BFF4631672364D70B5B9C5DFE41B2A6AE6FBA61E35EE83EE377185CF735E10E493CA2CE642D789993D2AA20F876BBB837F3B9B5E3DF8DA433FA5683749EFD7F4D00217335945F62B03A62AE2071F893A8C2726C35B83F5F181AFF67B0365B639F1375BAB04803DB5D7969033FF85BDC3103AFC07C90A4D3FD36E5EA9B4FF43481F45ED60CA7FBF4AA6586E99E5BB00F30F9F1F096A8BFF6710C101324CBBE33511FD3AE25F7262774122A22986E51A76619E71563BE23D4F93DBB604C3C2A267D933D9FB91675FE6F7C46ADAC7E053F921E441256A1FD568A5CE8975030472F916F7FD60DA82C7EB57636145BAECE41CF6A9842F3108C2F5F18064F0879997531B4DCF2D7747DD5F94CEBA2E3F6882ED42BE6CEA55F854D0A86712F7073A5BE0CFE23D9AE0A7E0A3AD60EDDAE32CA239A176C1A7C078673E957020B3A0CD1B8ED3271BC280E0EFA5BB1F58FF52E8E64479A0A684748F61794B58851BC8254FDB34E7513409EEFB401875A4B7CB043C09606F06F5D6B86ED258A9DEF562D0A526CA14E80601FB8F87436B67BA681D0103EF87D0774E7687E569C20DDDE5910C87E5AEE1E56D5EF18016383C097D60CA75A7766B6341732B10F4FC91FAEC2707724F5C45F4234BE8CF5A2ED2BA808336A1CFF852FA8FC9BF732B798EDB667E0F8BBC8CA282BE8ECD3B3010668F3B87762F7A0453D7CC52A5FB99A7B50D8463D557CF28CFEC00A31E81F57CEA787EA01800AFBBEDDBA8B3DC902001F4C718678D22D48A97508E659048E002BB64D891001559ACE7B3DA3F1268034F8D274A4A5E9E202C5B025471B1ECA4614F55A19C16F218F6066EBBD2B324E95EB061693F3EA62135786E4AB16F387C1D52C11E73AF401156635FF04F985A42236E301BFC1F53468D3DEF5D72B030EB84C3AD3A8F18E1017AE06FB8D6747DC2D157A4FA662E3E2078CDA593B99917A7B50DCF37E85A457D3B87FCE200CB3522D7BE11029F37FF4F150D62BF6398E4A143B443C2F03B6F5D33181E4184628FF33B183B14293CDEF36680BA2E9125B4BF5E5E26E4AAA65A2D903A8957957E822F93F7189C0DF89958C22C3578C55838DB9079CC984C7BBE0DA65DFDBE06B58FC006F850E8EC6CE929509EDB66FB7023DE7A82B08CE8816C422D872B8B7812EB7EBAC4CCF1D68E09E3BC5EFF4D8A7E691DEA909E01EED97A6BEF6E876AA7FF80543EFB3D4F96D535840DA1DBD765241B00B5D08CB5E4B5B4B7B4F942E4E3B84E0BD1FA94DC892DEEA546906AEAD8B4CA6EE6164474E427566FF96889939C6620460464C59C7576A05FA3DE62B914335B837D3BF3E6FAA6E7EFEF007402CDCD951D7E5D49A85ABCB43625A659A94556E33F274B9E83F5A28476467FECA29908E655A9B9FEC748787A17C637B2394150A6C5B189AB5EF52DD282B5D6FE81FE0075EDAB6DFA40E60D46CC306B1DA628E385302F93BB97F4F752ACBD37630B85789A3E33C817B1F080DB457219F51DCA8E75CA7E37D73007A4DA0589113340EB36988F68172E72CAD01F53EC7FE6D5512ABA0A47D963E319DD28235AE37B5FC057FAE49312DD3C5FF95AA45A55F00527B9A918A2333CE249F9493596FF9E59931F38BE8AA07B09C30DF5A81D7367CD53A281AF04F2E718872E0A6575C7349A9ECE0E71C9CDBE163AB230F7BEBD5BA80084EB0B476B491348172480363A144D46F4BC6F23AB18FFD013F514A51F1D8091350D37BD61CD17CB9989BC4FA5010E80EAAC98119506FC9BD40CFF3CCCA43D394D1254B0475E5F2C075BA5EC7547E25940D84555E6D342015A74C7F2EB329AEB434388E1835FCA54F44CA1BB5A9F52BA5DC1096224D75B5B096B0FB8F8F131FD431FD48E096FB59A385E371391CF86F511DEBD787BAF3CD36536FA4E4E954BA5937F20797931621C5531C83400CB98C39691B7F2E8E5388200868AD6477B575E6C55555471E99886C52DE05E470A16A62BDA4EBFC015A3FF94235BE8094146608C3A60C0E58024068992E209158BEB5DEF1A018CC25988811A1273098624A119468CEEB7AA41B72D1EE710197E80D831BBF9B7B7AAA29C9B5B41285B3D7EA0A38878BF1F58BDBD4AB66734027E9114370729CA6D563BDDB1B730A36ADEF665BCD47EAC1859F1D3C671FD5C2E444BEB60E2FF4B3F1A2E7F576D33F719B64B09F27D346A42D5F5EE908B2654C7EA6383BD67403DC3DFB76FBB4D92D34DB92C2FEE1BB02E08292444183974BE649252C511239F20922AE0D9D8CFE033E304DFEBDE299A2FB2B16E0CEC0F8E83F59CE3E5D01DF66EB43D6C49CF19F6B6E13D471637101C93486818BC3054AD1FD8E53A7863D8CE34414B0D2A2EF82193C914D12AFC3939E0B9A1583546DB0C62125E567C11F799166835388B0305337D8C2AE3039BE7009657B83ACAF0DD943EB47D5730827126EB11852F0DAD501E13F7FA4174695076157470252FAB07A7FC5F679C75724AF89B0EB5FBA9A88BD825E126B98D3625E2F167516D1E2B9682088842CF3D7E91CC5C00BA382549F98C4DA67DD42DDC3701358B9B48544D1C1ABDBAE46CF86BBFFD85EF415CF51F343C9B85E7542DCB271F466DD864C5CE560DFD8D5C7C66BCFEB20712C8039518A4896EDD70157509428619A558474477157BD1A477261BC6545D924B3C40307E113513069A1A2F66D1C8DBE8B56A9FFADC773A6181AD16BDCD0CDE1954C86F672D5BE0F00D8A22CCD4AE6A73D134012173AE1B75E72C95AFC5D9649C058E8252A62F8DF0F7C65D5614DBEB381D753CE377F21A2391071A78801C4EA3FCE7ECC8287816AAF0FF3062D28EBF614FA27AD3F9C72E0F9367F8A83A4B83965FA2FD03AAB55167C32E0001E3DBA8AA78A80004968057C79A8162B2FC1FA39181336129D0E8B4E028C247EC8982C0FEFEC0930506713A64F504D58DAF9FA2430D3560FD2CDCA7F06E4AD0B1996A5767EC15EA001AE9239E6CF8B5F0F2086FE5520657C0A3A39E3942D5031CD14FB5A11E4B649C1A595DF675FB30FD99CD3EA341F1D3D1B51853A6B552DE1C54AD2B83CC1CC9D06503AC66655A1EEA0FCEADB41C87F9D03A90421AD27E2FF17BF7165DC29D38E933205DE00D8E752138E5D3A42AEF8702BA05F275417B56F0FE7C6FCDB9013063B556C09C768A2E28D6FBB7B61D37F7A9FA821FCBCDDA4DD78B80686CFB584A1BD5CE5410112A8E63E7CBF1A062FCAAC6A30707B153CE8C49A87987CE9C357138504078270B6C05BD9AFC5D77717CE95A45031A6301E7CA966380BBB65CD7F9DCFC3260E512F49228C01E1E22ABAA98DD6B070D85593EDC77D877C2583BDC02C74D9D16183700A8DC552D86BA08BF28B3A4648B564AA202CDEFA60E428B2AC1E8418220822064BBBA3E551657BAB08B6D19A8D25E07C0B0C05370315059F9B22BA20D32F3D80793EB086F98DE2CED3D74A26F897470E34059E0D779FCFAA916D9E638372E5876C56CA9F6AF509C1FF6B9D015ED5126040B178C99B8CD028E37A34A9EEAEAE14E829A84AADCDA06D3BB004AE7E05C75D3651C687901661C74CB9314C89E6CC137DBB4633A0CD19D429E239B883FD4BBE3A99A0A696D3C1C2075532A44A90ACDC03277D679CF500B9079CE47FF8E996842FD826DE65E641260593DAC6E7E226BDA478A893B4C0DC403E748795240C2A439849EB0581096508D102963E55179B48EFB9DEBA7487926A8515E3F394553ACDF0F913B28E997991DF55BB2206D285C2BD22EECACB3EBD13C65116D4E1FABA924330EF5C044AD24BFB183BF14C115E5A32586129BD1543A11219CB890CF73A255273C759DD527A12E2F0381703F9BBDCC6A214FC61249D5397F784A3229E6628BC0A354421968755BAECB36B1DC66E1167CA39D25A044858C5C0C9EA8330FA76BEDAF7F1DB1C9EF7571A87F656E4D74E08F5409CBB39F10716E5B5868541819CC1BA19699A3752BF11090B86CFA9681EDF7ED7D56DF36AECD4D821D328A8AAE906248644A8F183D92DA8D32BC139039A859690F44E453293C6A56CDA54B26F3BEA80A148C67F1AC8F9070495D1FA65A8A9DC563500BC231A86E1E0DA573B7588598A48085BDB606118EED18160843A114E13FE0617C7D697F2A712628F00F52A23015E3231F0E9752384B524C13B1D71126094D8179F8883DE58655F0A01501BA36DD158AB7D43B75D9E86E8C42F1EE4F19BE08E2FE624BE9579456B1596D6656327BB798206845FC3CE5631C66FD178D3CD23B81067CDAC0998F339DDC67EEA1B1373ED846D12D3ABF2070001B6FD8E2792C591443E7E6D6AFA6FC48A70210BDB218CF11212690FAE39610899D76A2924718E9855EEFA6F75268F24CE01364E3167EEDF866CA48AFD150DF24743358CF0D70D54007DC05634E5DDC94F381039665D3DA999EC69FB40FF8B72552D081CB97933741DA0A79CB1302AFF1D94A4CBD8E7EE6B668577BA531DFC06DA620AB36334CC92025183CEC5A022E5E40179FA08C0B1160C61AF80E27E25B30E0F27CEC83C1361D646930E65E57FC71C9C4F00C8AB028785BFD1D183AD81CD3EE3DCDFB9CC569C756B6DA3D71B9BA521F0CE984EC4D710C34C881DC9FD61F1B5C0D7C07DA76973E74B793596CCFE4A615B30DB1C4E814A64231456B4EC47278BA2506DA6551B385D1015DB6854ED2591328F8A90E36E7C339BA9CC9316E085E208A9F2666F35BC68DC3282E7FF223983B92DCF1C00A9EB2F68733B1388EBE3F496501354CDE41BF04294D150DE14945973564839E4B2A25022F911B8795A2F69CC9BC8AE99E844B890535BD654D03E119659C7B8FFEB171A7F4E0F501F2E1EFDAFCA77CF43057DF01DEEC7C16C9373C2C7534A35445753FFBD0B85CFD7CBD565B95C12454B7F0103C169A0A79C0F292AEB5F153DAB9CBA13664B514921732D99D361C5462EFE85EA9E6DF9576178155A9A10A6DAC05B4EA2A56B42B5B1227FA507F2A14A427C617E8269270FF59706BE36397CE5E5E1DD757D4FBC8F88447C4D3F42270569537042CC5EFAC628134BD115487AB3CC70E996F947ABBC7885355BD034AF03DDFE0D204293465FC8EFED438E01893BBEA9F75B6033B471C15F656C5403B94547C94711DD516BA04FEE297B70CA8C5F76301808D53A756CA1782E9EC76ABF9FAA53753DB8114956F28240ED3E744C69D11A3D98E6A4CFBD0BCAC43F5856930296E5C5AD8AB36C6BAAAD365C1EB8C99B17BF9CEF319F3D59671B0E8522D9AE8224F5BFBEE8A9C59CF4F525F961C86C33CBFF162EC84D0567835EF42385E")
	if err != nil {
		t.Fatal(err)
	}
	csig2 = csig2[:len(csig2)-len(msg2)]
	if !bytes.Equal(sig2, csig2) {
		t.Error("xmss sig2 is incorrect")
	}
	if !Verify(sig2, msg2, mer.priv.root) {
		t.Error("XMSS verification 2 is incorrect")
	}
}

func TestXMSS2(t *testing.T) {
	seed := generateSeed()
	mer := NewMerkle(10, seed)
	msg := []byte("This is a test for XMSS.")
	var pre []byte
	for i := 0; i < 1<<10; i++ {
		sig := mer.Sign(msg)
		if !Verify(sig, msg, mer.priv.root) {
			t.Error("XMSS sig is incorrect")
		}
		if pre != nil && bytes.Equal(pre, sig) {
			t.Error("sig must not be same")
		}
		pre = sig
	}
}

func TestXMSS3(t *testing.T) {
	seed := generateSeed()
	mer := NewMerkle(10, seed)
	msg := []byte("This is a test for XMSS.")
	sig := mer.Sign(msg)
	msg[0] = 0
	if Verify(sig, msg, mer.priv.root) {
		t.Error("XMSS sig is incorrect")
	}
}

func TestXMSS16(t *testing.T) {
	seed := generateSeed()
	mer := NewMerkle(16, seed)
	msg := []byte("This is a test for XMSS height=16.")
	sig := mer.Sign(msg)
	if !Verify(sig, msg, mer.priv.root) {
		t.Error("XMSS sig is incorrect")
	}
}

func TestXMSSMarshal(t *testing.T) {
	seed := generateSeed()
	mer := NewMerkle(10, seed)
	msg := []byte("This is a test for XMSS height=16.")
	mer.Sign(msg)
	dat, err := mer.MarshalJSON()
	if err != nil {
		t.Error(err)
	}
	t.Log("marshalled Merkle", string(dat))
	sig := mer.Sign(msg)
	mer2 := Merkle{}
	if err = mer2.UnmarshalJSON(dat); err != nil {
		t.Error(err)
	}
	sig2 := mer2.Sign(msg)
	if !bytes.Equal(sig, sig2) {
		t.Error("invlaid marshal")
	}
}

func BenchmarkXMSS16(b *testing.B) {
	seed := generateSeed()
	b.ResetTimer()
	for i := 0; i < b.N; i++ {
		_ = NewMerkle(16, seed)
	}
}
func BenchmarkXMSS16Sign(b *testing.B) {
	seed := generateSeed()
	mer := NewMerkle(16, seed)
	msg := []byte("This is a test for XMSS.")
	b.ResetTimer()
	for i := 0; i < b.N; i++ {
		_ = mer.Sign(msg)
	}
}
func BenchmarkXMSS16Veri(b *testing.B) {
	seed := generateSeed()
	mer := NewMerkle(16, seed)
	msg := []byte("This is a test for XMSS.")
	sig := mer.Sign(msg)
	b.ResetTimer()
	for i := 0; i < b.N; i++ {
		Verify(sig, msg, mer.priv.root)
	}
}

// func BenchmarkXMSS20(b *testing.B) {
// 	seed := generateSeed()
// 	b.ResetTimer()
// 	for i := 0; i < b.N; i++ {
// 		_ = NewMerkle(20, seed)
// 	}
// }

func BenchmarkXMSS10(b *testing.B) {
	seed := generateSeed()
	b.ResetTimer()
	for i := 0; i < b.N; i++ {
		_ = NewMerkle(10, seed)
	}
}
func BenchmarkXMSS10Sign(b *testing.B) {
	seed := generateSeed()
	mer := NewMerkle(10, seed)
	msg := []byte("This is a test for XMSS.")
	b.ResetTimer()
	for i := 0; i < b.N; i++ {
		_ = mer.Sign(msg)
	}
}
func BenchmarkXMSS10Veri(b *testing.B) {
	seed := generateSeed()
	mer := NewMerkle(10, seed)
	msg := []byte("This is a test for XMSS.")
	sig := mer.Sign(msg)
	b.ResetTimer()
	for i := 0; i < b.N; i++ {
		Verify(sig, msg, mer.priv.root)
	}
}
